# Workflow Consolidation Recommendation

## Issue: Duplicate Static Web Apps Deployments

Two GitHub Actions workflows currently handle frontend deployment to Azure Static Web Apps:

### Workflow 1: `frontend-deploy.yml` (Custom)
- **Location**: `.github/workflows/frontend-deploy.yml`
- **Secret Used**: `AZURE_STATIC_WEB_APPS_API_TOKEN`
- **Triggers**: 
  - Push to `main` with changes to `frontend/**`
  - Pull requests
  - Manual dispatch
- **Features**:
  - Custom build step with Node.js caching
  - Explicit environment variable injection (`REACT_APP_API_URL`)
  - CI=false for warning tolerance
  - Clear job separation

### Workflow 2: `azure-static-web-apps-proud-coast-0ab079210.yml` (Auto-generated)
- **Location**: `.github/workflows/azure-static-web-apps-proud-coast-0ab079210.yml`
- **Secret Used**: `AZURE_STATIC_WEB_APPS_API_TOKEN_PROUD_COAST_0AB079210`
- **Triggers**:
  - Push to `main` (any changes)
  - Pull requests (any changes)
- **Features**:
  - Auto-generated by Azure Portal
  - Minimal configuration
  - Relies on Azure's build system

## Problem

Having two workflows causes:

1. **Duplicate Deployments**: Both workflows may trigger on the same push, causing confusion
2. **Secret Management Overhead**: Two different secret names for the same purpose
3. **Potential Conflicts**: Race conditions if both deploy simultaneously
4. **Maintenance Burden**: Updates must be made in two places

## Recommendation: Keep `frontend-deploy.yml`

### Reasons

1. **Better Control**: Explicit build steps and environment configuration
2. **Efficient Triggers**: Only runs when frontend changes (path filters)
3. **Clear Dependencies**: Shows required secrets and build process
4. **Consistent Naming**: Matches backend workflow naming convention
5. **Customizable**: Easy to add tests, linting, or other steps

### Migration Steps

#### Step 1: Verify Both Tokens Point to Same Resource

If both tokens deploy to the same Static Web App:

```bash
# In Azure Portal
1. Go to Static Web Apps
2. Find your Static Web App (e.g., "proud-coast-0ab079210")
3. Overview → Manage deployment token
4. This is your deployment token
```

#### Step 2: Consolidate to Single Secret

Option A: Use `AZURE_STATIC_WEB_APPS_API_TOKEN` (Recommended)

```bash
# 1. Verify AZURE_STATIC_WEB_APPS_API_TOKEN exists in GitHub Secrets
# 2. If not, copy value from AZURE_STATIC_WEB_APPS_API_TOKEN_PROUD_COAST_0AB079210
# 3. Update workflow to use AZURE_STATIC_WEB_APPS_API_TOKEN
```

Option B: Standardize on the auto-generated name

```bash
# Update frontend-deploy.yml to use:
# AZURE_STATIC_WEB_APPS_API_TOKEN_PROUD_COAST_0AB079210
```

#### Step 3: Disable Auto-generated Workflow

Option A: Delete the file
```bash
git rm .github/workflows/azure-static-web-apps-proud-coast-0ab079210.yml
git commit -m "Remove duplicate Static Web Apps workflow"
git push
```

Option B: Archive for reference
```bash
mkdir -p .github/workflows-archive
git mv .github/workflows/azure-static-web-apps-proud-coast-0ab079210.yml \
       .github/workflows-archive/
git commit -m "Archive auto-generated Static Web Apps workflow"
git push
```

Option C: Disable in GitHub
1. Go to GitHub → Actions
2. Find "Azure Static Web Apps CI/CD" workflow
3. Click "..." → Disable workflow

#### Step 4: Update Secret Reference (if needed)

If you chose Option A and want to use `AZURE_STATIC_WEB_APPS_API_TOKEN`:

The `frontend-deploy.yml` already uses the correct secret name, so no changes needed!

#### Step 5: Test Deployment

```bash
# Make a small change to frontend
echo "// Testing deployment" >> frontend/src/App.js

# Commit and push
git add frontend/src/App.js
git commit -m "Test frontend deployment"
git push origin main

# Monitor GitHub Actions
# Only frontend-deploy.yml should run
```

## Implementation Plan

### Option 1: Use Custom Workflow (RECOMMENDED)

```bash
# 1. Ensure AZURE_STATIC_WEB_APPS_API_TOKEN secret exists
# 2. Remove auto-generated workflow
cd /path/to/hr-command-center
git rm .github/workflows/azure-static-web-apps-proud-coast-0ab079210.yml
git commit -m "Remove duplicate Azure Static Web Apps workflow

Keep custom frontend-deploy.yml for better control and consistency.
Auto-generated workflow is redundant."
git push origin main
```

### Option 2: Use Auto-generated Workflow

```bash
# 1. Update frontend-deploy.yml secret reference
# Edit .github/workflows/frontend-deploy.yml
# Change: AZURE_STATIC_WEB_APPS_API_TOKEN
# To: AZURE_STATIC_WEB_APPS_API_TOKEN_PROUD_COAST_0AB079210

# 2. Commit changes
git add .github/workflows/frontend-deploy.yml
git commit -m "Standardize on auto-generated Static Web Apps token"
git push origin main
```

## Recommended Action

**Choose Option 1**: Remove the auto-generated workflow and use `frontend-deploy.yml`.

### Benefits
- ✅ Single deployment workflow
- ✅ Consistent secret naming
- ✅ Better build control
- ✅ Path-based triggers (efficiency)
- ✅ Easy to maintain and extend

### Command to Execute

```bash
# Remove duplicate workflow
git rm .github/workflows/azure-static-web-apps-proud-coast-0ab079210.yml

# Commit and push
git commit -m "Consolidate frontend deployment workflows

- Remove auto-generated azure-static-web-apps-proud-coast-0ab079210.yml
- Keep custom frontend-deploy.yml for better control
- Reduces duplicate deployments and maintenance overhead"

git push origin main
```

## Verification

After consolidation:

1. ✅ Only one Static Web Apps workflow exists
2. ✅ Only one deployment per frontend change
3. ✅ Secret naming is consistent
4. ✅ Deployment succeeds on push to main

## Notes

- Both workflows will still work independently; consolidation is for efficiency
- The auto-generated workflow was created when Static Web App was provisioned in Azure Portal
- Future Azure Static Web App connections should disable auto-generation or immediately consolidate

## Related Files

- `.github/workflows/frontend-deploy.yml` - Custom frontend deployment workflow
- `.github/workflows/backend-deploy.yml` - Backend deployment workflow
- `docs/DEPLOYMENT_CHECKLIST.md` - Complete deployment checklist
- `docs/AZURE_SETUP_GUIDE.md` - Azure setup instructions

---

**Status**: Consolidation completed in this PR
**Action Required**: None (workflow consolidation complete)
**Priority**: N/A (completed)
